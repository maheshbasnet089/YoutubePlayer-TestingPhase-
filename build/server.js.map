{"version":3,"sources":["webpack:///webpack/bootstrap a1d009c956caec8b6c3a","webpack:///./src/server/server.js","webpack:///external \"source-map-support/register\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///external \"chalk\"","webpack:///external \"rxjs\"","webpack:///./src/shared/operators.js","webpack:///./src/shared/observable-socket.js","webpack:///./src/server/repositories/file.js","webpack:///external \"fs\"","webpack:///./src/server/services/youtube.js","webpack:///external \"moment\"","webpack:///external \"lodash\"","webpack:///./src/server/lib/request.js","webpack:///external \"request\"","webpack:///./src/shared/validation/playlist.js","webpack:///./src/shared/validator.js","webpack:///./src/server/modules/users.js","webpack:///./src/server/lib/module.js","webpack:///./src/shared/validation/users.js","webpack:///./src/server/modules/playlist.js","webpack:///./src/server/modules/chat.js","webpack:///./src/shared/validation/chat.js","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"webpack-hot-middleware\"","webpack:///external \"webpack\"","webpack:///./webpack.client.js","webpack:///external \"path\"","webpack:///external \"extract-text-webpack-plugin\""],"names":["isDevelopment","process","env","NODE_ENV","app","server","http","Server","io","USE_WEBPACK","webpackMiddleware","require","webpackHotMiddlware","webpack","clientConfig","compiler","use","publicPath","stats","colors","chunks","assets","timings","modules","hash","version","console","log","chalk","bgRed","set","express","static","useExternalStyles","get","req","res","render","videoServices","YoutubeService","playlistRepository","FileRepository","users","UsersModule","chat","ChatModule","playlist","PlaylistModule","on","socket","request","connection","remoteAddress","client","ObservableSocket","mod","registerClient","clientRegistered","port","PORT","startServer","listen","Observable","merge","map","m","init$","subscribe","complete","error","stack","prototype","safeSubscribe","next","subscription","item","e","unsubscribe","catchWrap","catch","of","fromEventNoDefault","element","event","fromEvent","do","preventDefault","fromPrompt","promptText","result","window","prompt","observer","clientMessage","fail","success","message","Error","throw","successObservable","empty","_state","isConnected","isReconnecting","_socket","_actionCallbacks","_requests","_nextRequestId","status$","on$","attempt","publishReplay","refCount","state","callback","off","arg","emit","action","id","_registerCallbacks","subject","ReplaySubject","hasOwnProperty","_popRequest","requestId","value","hasValue","_emitError","actions","onAction","readFile","bindNodeCallback","fs","writeFile","filename","_filename","JSON","parse","contents","items","stringify","YOUTUBE_ENDPOINT","apiKey","_apiKey","url","match","YOUTUBE_REGEXES","r","find","a","getSourceFromId$","_buildGetVideoUrl","flatMap","data","length","snippet","contentDetails","type","thumb","thumbnails","default","title","totalTime","moment","duration","asSeconds","getJson$","response","body","validateAddSource","validator","Validator","_","some","test","_errors","join","push","isValid","errors","AuthContext","Symbol","_io","_userList","_users","username","reduce","ch","charCodeAt","Math","abs","hue","saturation","lightness","auth","isLoggedIn","trim","throw$","name","color","getColorForUsername","getUserForClient","index","indexOf","splice","onActions","loginClient$","logoutClient","ModuleBase","validateLogin","USERNAME_REGEX","usersModule","_repository","_services","_nextSourceId","_playlist","_currentIndex","_currentSource","_currentTime","setInterval","_tickUpdateTime","bind","_tickUpdateClients","getAll$","setPlaylist","source","newIndex","_createCurrentEvent","setCurrentSource","getSource$","service","process$","addSource","insertIndex","afterId","playNextSource","time","fromId","toId","fromSource","getSourceById","toSource","fromIndex","toIndex","sourceIndex","addSourceFromUrl$","moveSource","deleteSourceById","MAX_HISTORY","BATCH_SIZE","_chatLog","user","newMessage","Date","getTime","sendMessage","validateSendMessage","MESSAGE_TYPES","includes","path","ExtractTextPlugin","vendorModules","dirname","resolve","createConfig","isDebug","devTool","plugins","optimize","CommonsChunkPlugin","cssLoader","loader","sassLoader","appEntry","UglifyJsPlugin","extract","HotModuleReplacementPlugin","devtool","entry","application","vendor","output","alias","shared","module","loaders","exclude","exports","create"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a1d009c956caec8b6c3a","import \"source-map-support/register\";\r\n\r\nimport express from \"express\";\r\nimport http from \"http\";\r\nimport socketIo from \"socket.io\";\r\nimport chalk from \"chalk\";\r\nimport {Observable} from \"rxjs\";\r\n\r\nimport \"shared/operators\";\r\nimport {ObservableSocket} from \"shared/observable-socket\";\r\n\r\nimport {FileRepository} from \"./repositories/file\";\r\nimport {YoutubeService} from \"./services/youtube\";\r\n\r\nimport {UsersModule} from \"./modules/users\";\r\nimport {PlaylistModule} from \"./modules/playlist\";\r\nimport {ChatModule} from \"./modules/chat\";\r\n\r\nconst isDevelopment = process.env.NODE_ENV !== \"production\";\r\n\r\n// ------------------------\r\n// Setup\r\nconst app = express();\r\nconst server = new http.Server(app);\r\nconst io = socketIo(server);\r\n\r\n// ------------------------\r\n// Client Webpack\r\nif (process.env.USE_WEBPACK === \"true\") {\r\n\tvar webpackMiddleware = require(\"webpack-dev-middleware\"),\r\n\t\twebpackHotMiddlware = require(\"webpack-hot-middleware\"),\r\n\t\twebpack = require(\"webpack\"),\r\n\t\tclientConfig = require(\"../../webpack.client\");\r\n\t\t\r\n\tconst compiler = webpack(clientConfig);\r\n\tapp.use(webpackMiddleware(compiler, {\r\n\t\tpublicPath: \"/build/\",\r\n\t\tstats: {\r\n\t\t\tcolors: true,\r\n\t\t\tchunks: false,\r\n\t\t\tassets: false,\r\n\t\t\ttimings: false,\r\n\t\t\tmodules: false,\r\n\t\t\thash: false,\r\n\t\t\tversion: false\r\n\t\t}\r\n\t}));\r\n\t\r\n\tapp.use(webpackHotMiddlware(compiler));\r\n\tconsole.log(chalk.bgRed(\"Using WebPack Dev Middleware! THIS IS FOR DEV ONLY!\"));\r\n}\r\n\r\n// ------------------------\r\n// Configure Express\r\napp.set(\"view engine\", \"jade\");\r\napp.use(express.static(\"public\"));\r\n\r\nconst useExternalStyles = !isDevelopment;\r\napp.get(\"/\", (req, res) => {\r\n\tres.render(\"index\", {\r\n\t\tuseExternalStyles\r\n\t});\r\n});\r\n\r\n// ------------------------\r\n// Services\r\nconst videoServices = [new YoutubeService(\"{AIzaSyCsdHbx0_RCrYMrn1psn7EXfjQ6Aq6B1ws}\")];\r\nconst playlistRepository = new FileRepository(\"./data/playlist.json\");\r\n\r\n// ------------------------\r\n// Modules\r\nconst users = new UsersModule(io);\r\nconst chat = new ChatModule(io, users);\r\nconst playlist = new PlaylistModule(io, users, playlistRepository, videoServices);\r\nconst modules = [users, chat, playlist];\r\n\r\n// ------------------------\r\n// Socket\r\nio.on(\"connection\", socket => {\r\n\tconsole.log(`Got connection from ${socket.request.connection.remoteAddress}`);\r\n\t\r\n\tconst client = new ObservableSocket(socket);\r\n\t\r\n\tfor (let mod of modules)\r\n\t\tmod.registerClient(client);\r\n\t\t\r\n\tfor (let mod of modules)\r\n\t\tmod.clientRegistered(client);\r\n});\r\n\r\n// ------------------------\r\n// Startup\r\nconst port = process.env.PORT || 3000;\r\nfunction startServer() {\r\n\tserver.listen(port, () => {\r\n\t\tconsole.log(`Started http server on ${port}`);\r\n\t});\r\n}\r\n\r\nObservable.merge(...modules.map(m => m.init$()))\r\n\t.subscribe({\r\n\t\tcomplete() {\r\n\t\t\tstartServer();\r\n\t\t},\r\n\t\t\r\n\t\terror(error) {\r\n\t\t\tconsole.error(`COuld not init module: ${error.stack || error}`);\r\n\t\t}\r\n\t});\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"source-map-support/register\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support/register\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"rxjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rxjs\"\n// module id = 6\n// module chunks = 0","import {Observable} from \"rxjs\";\r\n\r\nObservable.prototype.safeSubscribe = function(next, error, complete) {\r\n\tconst subscription = this.subscribe(\r\n\t\titem => {\r\n\t\t\ttry {\r\n\t\t\t\tnext(item);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e.stack || e);\r\n\t\t\t\tsubscription.unsubscribe();\r\n\t\t\t}\r\n\t\t}, \r\n\t\terror,\r\n\t\tcomplete);\r\n\t\r\n\treturn subscription;\r\n};\r\n\r\nObservable.prototype.catchWrap = function() {\r\n\treturn this.catch(error => Observable.of({error: error}));\r\n};\r\n\r\nObservable.fromEventNoDefault = function(element, event) {\r\n\treturn Observable.fromEvent(element, event)\r\n\t\t.do(e => e.preventDefault());\r\n};\r\n\r\nObservable.fromPrompt = function(promptText) {\r\n\treturn new Observable(observer => {\r\n\t\tconst result = window.prompt(promptText);\r\n\t\tobserver.next(result);\r\n\t\tobserver.complete();\r\n\t});\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/shared/operators.js","import {Observable, ReplaySubject} from \"rxjs\";\r\n\r\nexport function clientMessage(message) {\r\n\tconst error = new Error(message);\r\n\terror.clientMessage = message;\r\n\treturn error;\r\n}\r\n\r\nexport function fail(message) {\r\n\treturn Observable.throw({clientMessage: message});\r\n}\r\n\r\nlet successObservable = Observable.empty();\r\nexport function success() {\r\n\treturn successObservable;\r\n}\r\n\r\nexport class ObservableSocket {\r\n\tget isConnected() { return this._state.isConnected; }\r\n\tget isReconnecting() { return this._state.isReconnecting; }\r\n\tget isTotallyDead() { return !this.isConnected && !this.isReconnecting; }\r\n\r\n\tconstructor(socket) {\r\n\t\tthis._socket = socket;\r\n\t\tthis._state = {};\r\n\t\tthis._actionCallbacks = {};\r\n\t\tthis._requests = {};\r\n\t\tthis._nextRequestId = 0;\r\n\r\n\t\tthis.status$ = Observable.merge(\r\n\t\t\tthis.on$(\"connect\").map(() => ({ isConnected: true })),\r\n\t\t\tthis.on$(\"disconnect\").map(() => ({ isConnected: false })),\r\n\t\t\tthis.on$(\"reconnecting\").map(attempt => ({ isConnected: false, isReconnecting: true, attempt })),\r\n\t\t\tthis.on$(\"reconnect_failed\").map(() => ({ isConnected: false, isReconnecting: false })))\r\n\t\t\t.publishReplay(1)\r\n\t\t\t.refCount();\r\n\t\t\t\r\n\t\tthis.status$.subscribe(state => this._state = state);\r\n\t}\r\n\r\n\t// -----------------\r\n\t// Basic Wrappers\r\n\ton$(event) {\r\n\t\treturn Observable.fromEvent(this._socket, event);\r\n\t}\r\n\r\n\ton(event, callback) {\r\n\t\tthis._socket.on(event, callback);\r\n\t}\r\n\r\n\toff(event, callback) {\r\n\t\tthis._socket.off(event, callback);\r\n\t}\r\n\r\n\temit(event, arg) {\r\n\t\tthis._socket.emit(event, arg);\r\n\t}\r\n\r\n\t// -----------------\r\n\t// Emit (Client Side)\r\n\temitAction$(action, arg) {\r\n\t\tconst id = this._nextRequestId++;\r\n\t\tthis._registerCallbacks(action);\r\n\t\t\r\n\t\tconst subject = this._requests[id] = new ReplaySubject(1);\r\n\t\tthis._socket.emit(action, arg, id);\r\n\t\treturn subject;\r\n\t}\r\n\t\r\n\t_registerCallbacks(action) {\r\n\t\tif (this._actionCallbacks.hasOwnProperty(action))\r\n\t\t\treturn;\r\n\t\t\r\n\t\tthis._socket.on(action, (arg, id) => {\r\n\t\t\tconst request = this._popRequest(id);\r\n\t\t\tif (!request)\r\n\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\trequest.next(arg);\r\n\t\t\trequest.complete();\r\n\t\t});\r\n\t\t\r\n\t\tthis._socket.on(`${action}:fail`, (arg, id) => {\r\n\t\t\tconst request = this._popRequest(id);\r\n\t\t\tif (!request)\r\n\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\trequest.error(arg);\r\n\t\t});\r\n\t\t\r\n\t\tthis._actionCallbacks[action] = true;\r\n\t}\r\n\t\r\n\t_popRequest(id) {\r\n\t\tif (!this._requests.hasOwnProperty(id)) {\r\n\t\t\tconsole.error(`Event with id ${id} was returned twice, or the server did not send back an ID!`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst request = this._requests[id];\r\n\t\tdelete this._requests[id];\r\n\t\treturn request;\r\n\t}\r\n\t\r\n\t// -----------------\r\n\t// On (Server Side)\r\n\tonAction(action, callback) {\r\n\t\tthis._socket.on(action, (arg, requestId) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst value = callback(arg);\r\n\t\t\t\tif (!value) {\r\n\t\t\t\t\tthis._socket.emit(action, null, requestId);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (typeof(value.subscribe) !== \"function\") {\r\n\t\t\t\t\tthis._socket.emit(action, value, requestId);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet hasValue = false;\r\n\t\t\t\tvalue.subscribe({\r\n\t\t\t\t\tnext: (item) => {\r\n\t\t\t\t\t\tif (hasValue)\r\n\t\t\t\t\t\t\tthrow new Error(`Action ${action} produced more than one value.`);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._socket.emit(action, item, requestId);\r\n\t\t\t\t\t\thasValue = true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\t\t\t\t\terror: (error) => {\r\n\t\t\t\t\t\tthis._emitError(action, requestId, error);\r\n\t\t\t\t\t\tconsole.error(error.stack || error);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t\r\n\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\tif (!hasValue)\r\n\t\t\t\t\t\t\tthis._socket.emit(action, null, requestId);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tcatch (error) {\r\n\t\t\t\tif (typeof(requestId) !== \"undefined\")\r\n\t\t\t\t\tthis._emitError(action, requestId, error);\r\n\t\t\t\t\t\r\n\t\t\t\tconsole.error(error.stack || error);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\tonActions(actions) {\r\n\t\tfor (let action in actions) {\r\n\t\t\tif (!actions.hasOwnProperty(action))\r\n\t\t\t\tcontinue;\r\n\t\t\t\t\r\n\t\t\tthis.onAction(action, actions[action]);\r\n\t\t}\r\n\t}\r\n\t\r\n\t_emitError(action, id, error) {\r\n\t\tconst message = (error && error.clientMessage) || \"Fatal Error\";\r\n\t\tthis._socket.emit(`${action}:fail`, {message}, id);\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/observable-socket.js","import fs from \"fs\";\r\nimport {Observable} from \"rxjs\";\r\n\r\nconst readFile = Observable.bindNodeCallback(fs.readFile);\r\nconst writeFile = Observable.bindNodeCallback(fs.writeFile);\r\n\r\nexport class FileRepository {\r\n\tconstructor(filename) {\r\n\t\tthis._filename = filename;\r\n\t}\r\n\t\r\n\tgetAll$() {\r\n\t\treturn readFile(this._filename)\r\n\t\t\t.map(contents => JSON.parse(contents))\r\n\t\t\t.do(() => {\r\n\t\t\t\tconsole.log(`${this._filename}: got all data`);\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.error(`${this._filename}: failed to get all data: ${e.stack || e}`);\r\n\t\t\t\treturn Observable.throw(e);\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tsave$(items) {\r\n\t\treturn writeFile(this._filename, JSON.stringify(items))\r\n\t\t\t.do(() => {\r\n\t\t\t\tconsole.log(`${this._filename}: data saved`);\r\n\t\t\t})\r\n\t\t\t.catch(e => {\r\n\t\t\t\tconsole.error(`${this._filename}: failed to save data: ${e.stack || e}`);\r\n\t\t\t});\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/repositories/file.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 10\n// module chunks = 0","import {Observable} from \"rxjs\";\r\nimport moment from \"moment\";\r\nimport _ from \"lodash\";\r\n\r\nimport {getJson$} from \"../lib/request\";\r\nimport {YOUTUBE_REGEXES} from \"shared/validation/playlist\";\r\nimport {fail} from \"shared/observable-socket\";\r\n\r\nconst YOUTUBE_ENDPOINT = \"https://www.googleapis.com/youtube/v3\";\r\n\r\nexport class YoutubeService {\r\n\tconstructor(apiKey) {\r\n\t\tthis._apiKey = apiKey;\r\n\t\t\r\n\t\tif (apiKey === \"{fixme}\")\r\n\t\t\tconsole.error(\"Please enter your own YouTube API key in server.js\");\r\n\t}\r\n\t\r\n\tprocess$(url) {\r\n\t\tif (this._apiKey === \"{fixme}\") {\r\n\t\t\tconsole.error(\"Please enter your own YouTube API key in server.js\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t\t\r\n\t\tconst match = _(YOUTUBE_REGEXES)\r\n\t\t\t.map(r => url.match(r))\r\n\t\t\t.find(a => a != null);\r\n\t\t\t\r\n\t\treturn match ? this.getSourceFromId$(match[1]) : null;\r\n\t}\r\n\t\r\n\tgetSourceFromId$(id) {\r\n\t\treturn getJson$(this._buildGetVideoUrl(id))\r\n\t\t\t.flatMap(data => {\r\n\t\t\t\tif (!data || data.items.length != 1)\r\n\t\t\t\t\treturn fail(`Cannot locate youtube video ${id}`);\r\n\t\t\t\t\t\r\n\t\t\t\tconst {id, snippet, contentDetails} = data.items[0];\r\n\t\t\t\treturn Observable.of({\r\n\t\t\t\t\ttype: \"youtube\",\r\n\t\t\t\t\tthumb: snippet.thumbnails.default.url,\r\n\t\t\t\t\turl: id,\r\n\t\t\t\t\ttitle: snippet.title || \"{No Title}\",\r\n\t\t\t\t\ttotalTime: moment.duration(contentDetails.duration).asSeconds()\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t}\r\n\t\r\n\t_buildGetVideoUrl(id) {\r\n\t\treturn `${YOUTUBE_ENDPOINT}/videos?id=${id}&key=${this._apiKey}&part=snippet,contentDetails,statistics,status`;\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/services/youtube.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 13\n// module chunks = 0","import {Observable} from \"rxjs\";\r\nimport request from \"request\";\r\n\r\nexport function getJson$(url) {\r\n\treturn new Observable(observer => {\r\n\t\trequest(url, (error, response, body) => {\r\n\t\t\tif (error) {\r\n\t\t\t\tobserver.error(error);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tobserver.next(JSON.parse(body));\r\n\t\t\tobserver.complete();\r\n\t\t});\r\n\t});\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/request.js","module.exports = require(\"request\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request\"\n// module id = 15\n// module chunks = 0","import _ from \"lodash\";\r\n\r\nimport {Validator} from \"../validator\";\r\n\r\nexport const YOUTUBE_REGEXES = [\r\n\t/https?:\\/\\/(?:www\\.)?youtube\\.com\\/.*?v=(.*)$/,\r\n\t/https?:\\/\\/youtu\\.be\\/(.*)/\r\n];\r\n\r\nexport function validateAddSource(url) {\r\n\tconst validator = new Validator();\r\n\tif (!_.some(YOUTUBE_REGEXES, r => r.test(url)))\r\n\t\tvalidator.error(`Invalid Url`);\r\n\t\r\n\treturn validator;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/playlist.js","import {Observable} from \"rxjs\";\r\n\r\nexport class Validator {\r\n\tget isValid() { return !this._errors.length; }\r\n\tget errors() { return this._errors; }\r\n\tget message() { return this._errors.join(\", \"); }\r\n\t\r\n\tconstructor() {\r\n\t\tthis._errors = [];\r\n\t}\r\n\t\r\n\terror(message) {\r\n\t\tthis._errors.push(message);\r\n\t}\r\n\t\r\n\ttoObject() {\r\n\t\tif (this.isValid)\r\n\t\t\treturn {};\r\n\t\t\t\r\n\t\treturn {\r\n\t\t\terrors: this._errors,\r\n\t\t\tmessage: this.message\r\n\t\t};\r\n\t}\r\n\t\r\n\tthrow$() {\r\n\t\treturn Observable.throw({clientMessage: this.message});\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validator.js","import _ from \"lodash\";\r\nimport {Observable} from \"rxjs\";\r\n\r\nimport {ModuleBase} from \"../lib/module\";\r\nimport {validateLogin} from \"shared/validation/users\";\r\nimport {fail} from \"shared/observable-socket\";\r\n\r\nconst AuthContext = Symbol(\"AuthContext\");\r\n\r\nexport class UsersModule extends ModuleBase {\r\n\tconstructor(io) {\r\n\t\tsuper();\r\n\t\tthis._io = io;\r\n\t\tthis._userList = [];\r\n\t\tthis._users = {};\r\n\t}\r\n\t\r\n\tgetColorForUsername(username) {\r\n\t\tlet hash = _.reduce(username,\r\n\t\t\t(hash, ch) => ch.charCodeAt(0) + (hash << 6) + (hash << 16) - hash, 0); \r\n\t\t\t\r\n\t\thash = Math.abs(hash);\r\n\t\tconst hue = hash % 360,\r\n\t\t\tsaturation = hash % 25 + 70,\r\n\t\t\tlightness = 100 - (hash % 15 + 35);\r\n\t\t\t\r\n\t\treturn `hsl(${hue}, ${saturation}%, ${lightness}%)`;\r\n\t}\r\n\t\r\n\tgetUserForClient(client) {\r\n\t\tconst auth = client[AuthContext];\r\n\t\tif (!auth)\r\n\t\t\treturn null;\r\n\t\t\t\t\r\n\t\treturn auth.isLoggedIn ? auth : null;\r\n\t}\r\n\t\r\n\tloginClient$(client, username) {\r\n\t\tusername = username.trim();\r\n\t\t\r\n\t\tconst validator = validateLogin(username);\r\n\t\tif (!validator.isValid)\r\n\t\t\treturn validator.throw$();\r\n\t\t\t\r\n\t\tif (this._users.hasOwnProperty(username))\r\n\t\t\treturn fail(`Username ${username} is already taken`);\r\n\t\t\t\r\n\t\tconst auth = client[AuthContext] || (client[AuthContext] = {});\r\n\t\tif (auth.isLoggedIn)\r\n\t\t\treturn fail(\"You are already logged in\");\r\n\t\t\t\r\n\t\tauth.name = username;\r\n\t\tauth.color = this.getColorForUsername(username);\r\n\t\tauth.isLoggedIn = true;\r\n\t\t\r\n\t\tthis._users[username] = client;\r\n\t\tthis._userList.push(auth);\r\n\t\t\r\n\t\tthis._io.emit(\"users:added\", auth);\r\n\t\tconsole.log(`User ${username} logged in`);\r\n\t\treturn Observable.of(auth);\r\n\t}\r\n\t\r\n\tlogoutClient(client) {\r\n\t\tconst auth = this.getUserForClient(client);\r\n\t\tif (!auth)\r\n\t\t\treturn;\r\n\t\t\t\r\n\t\tconst index = this._userList.indexOf(auth);\r\n\t\tthis._userList.splice(index, 1);\r\n\t\tdelete this._users[auth.name];\r\n\t\tdelete client[AuthContext];\r\n\t\t\r\n\t\tthis._io.emit(\"users:removed\", auth);\r\n\t\tconsole.log(`User ${auth.name} logged out`);\r\n\t}\r\n\t\r\n\tregisterClient(client) {\r\n\t\tclient.onActions({\r\n\t\t\t\"users:list\": () => {\r\n\t\t\t\treturn this._userList;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t\"auth:login\": ({name}) => {\r\n\t\t\t\treturn this.loginClient$(client, name);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t\"auth:logout\": () => {\r\n\t\t\t\tthis.logoutClient(client);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tclient.on(\"disconnect\", () => {\r\n\t\t\tthis.logoutClient(client);\r\n\t\t});\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/users.js","import {Observable} from \"rxjs\";\r\n\r\n/*eslint no-unused-vars: \"off\"*/\r\n\r\nexport class ModuleBase {\r\n\tinit$() {\r\n\t\treturn Observable.empty();\r\n\t}\r\n\t\r\n\tregisterClient(client) {\r\n\t}\r\n\t\r\n\tclientRegistered(client) {\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/module.js","import {Validator} from \"../validator\";\r\n\r\nexport let USERNAME_REGEX = /^[\\w\\d_-]+$/;\r\n\r\nexport function validateLogin(username) {\r\n\tconst validator = new Validator();\r\n\t\r\n\tif (username.length >= 20)\r\n\t\tvalidator.error(\"Username must be fewer than 20 characters\");\r\n\t\t\r\n\tif (!USERNAME_REGEX.test(username))\r\n\t\tvalidator.error(\"Username can only contain numbers, digits, underscores and dashes\");\r\n\t\t\r\n\treturn validator;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/users.js","import {Observable} from \"rxjs\";\r\nimport _ from \"lodash\";\r\n\r\nimport {ModuleBase} from \"../lib/module\";\r\n\r\nimport {fail} from \"shared/observable-socket\";\r\nimport {validateAddSource} from \"shared/validation/playlist\";\r\n\r\nexport class PlaylistModule extends ModuleBase {\r\n\tconstructor(io, usersModule, playlistRepository, videoServices) {\r\n\t\tsuper();\r\n\r\n\t\tthis._io = io;\r\n\t\tthis._users = usersModule;\r\n\t\tthis._repository = playlistRepository;\r\n\t\tthis._services = videoServices;\r\n\r\n\t\tthis._nextSourceId = 1;\r\n\t\tthis._playlist = [];\r\n\t\tthis._currentIndex = -1;\r\n\t\tthis._currentSource = null;\r\n\t\tthis._currentTime = 0;\r\n\r\n\t\tsetInterval(this._tickUpdateTime.bind(this), 1000);\r\n\t\tsetInterval(this._tickUpdateClients.bind(this), 5000);\r\n\t}\r\n\r\n\tinit$() {\r\n\t\treturn this._repository.getAll$().do(this.setPlaylist.bind(this));\r\n\t}\r\n\r\n\tgetSourceById(id) {\r\n\t\treturn _.find(this._playlist, { id });\r\n\t}\r\n\r\n\tsetPlaylist(playlist) {\r\n\t\tthis._playlist = playlist;\r\n\r\n\t\tfor (let source of playlist)\r\n\t\t\tsource.id = this._nextSourceId++;\r\n\r\n\t\tthis._io.emit(\"playlist:list\", this._playlist);\r\n\t}\r\n\r\n\tsetCurrentSource(source) {\r\n\t\tif (source == null) {\r\n\t\t\tthis._currentSource = null;\r\n\t\t\tthis._currentIndex = this._currentTime = 0;\r\n\t\t} else {\r\n\t\t\tconst newIndex = this._playlist.indexOf(source);\r\n\t\t\tif (newIndex === -1)\r\n\t\t\t\tthrow new Error(`Cannot set current to source ${source.id} / ${source.title}, it was not found`);\r\n\r\n\t\t\tthis._currentTime = 0;\r\n\t\t\tthis._currentSource = source;\r\n\t\t\tthis._currentIndex = newIndex;\r\n\t\t}\r\n\r\n\t\tthis._io.emit(\"playlist:current\", this._createCurrentEvent());\r\n\t\tconsole.log(`playlist: setting current to ${source ? source.title : \"{nothing}\"}`);\r\n\t}\r\n\r\n\tplayNextSource() {\r\n\t\tif (!this._playlist.length) {\r\n\t\t\tthis.setCurrentSource(null);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._currentIndex + 1 >= this._playlist.length)\r\n\t\t\tthis.setCurrentSource(this._playlist[0]);\r\n\t\telse\r\n\t\t\tthis.setCurrentSource(this._playlist[this._currentIndex + 1]);\r\n\t}\r\n\r\n\taddSourceFromUrl$(url) {\r\n\t\tconst validator = validateAddSource(url);\r\n\t\tif (!validator.isValid)\r\n\t\t\treturn validator.throw$();\r\n\r\n\t\treturn new Observable(observer => {\r\n\t\t\tlet getSource$ = null;\r\n\r\n\t\t\tfor (let service of this._services) {\r\n\t\t\t\tgetSource$ = service.process$(url);\r\n\r\n\t\t\t\tif (getSource$)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (!getSource$)\r\n\t\t\t\treturn fail(`No service accepted url ${url}`);\r\n\r\n\t\t\tgetSource$\r\n\t\t\t\t.do(source => this.addSource(source))\r\n\t\t\t\t.subscribe(observer);\r\n\t\t});\r\n\t}\r\n\r\n\taddSource(source) {\r\n\t\tsource.id = this._nextSourceId++;\r\n\r\n\t\tlet insertIndex = 0,\r\n\t\t\tafterId = -1;\r\n\r\n\t\tif (this._currentSource) {\r\n\t\t\tafterId = this._currentSource.id;\r\n\t\t\tinsertIndex = this._currentIndex + 1;\r\n\t\t}\r\n\r\n\t\tthis._playlist.splice(insertIndex, 0, source);\r\n\t\tthis._io.emit(\"playlist:added\", { source, afterId });\r\n\r\n\t\tif (!this._currentSource)\r\n\t\t\tthis.setCurrentSource(source);\r\n\r\n\t\tconsole.log(`playlist: added ${source.title}`);\r\n\t}\r\n\r\n\t_tickUpdateTime() {\r\n\t\tif (this._currentSource == null) {\r\n\t\t\tif (this._playlist.length)\r\n\t\t\t\tthis.setCurrentSource(this._playlist[0]);\r\n\t\t} else {\r\n\t\t\tthis._currentTime++;\r\n\t\t\tif (this._currentTime > this._currentSource.totalTime + 2)\r\n\t\t\t\tthis.playNextSource();\r\n\t\t}\r\n\t}\r\n\r\n\t_tickUpdateClients() {\r\n\t\tthis._io.emit(\"playlist:current\", this._createCurrentEvent());\r\n\t}\r\n\r\n\t_createCurrentEvent() {\r\n\t\treturn this._currentSource\r\n\t\t\t? {\r\n\t\t\t\tid: this._currentSource.id,\r\n\t\t\t\ttime: this._currentTime\r\n\t\t\t} : {\r\n\t\t\t\tid: null,\r\n\t\t\t\ttime: 0\r\n\t\t\t};\r\n\t}\r\n\t\r\n\tmoveSource(fromId, toId) {\r\n\t\tconst fromSource = this.getSourceById(fromId);\r\n\t\tif (!fromSource)\r\n\t\t\tthrow new Error(`Could not find \"from\" source ${fromId}`);\r\n\t\t\t\r\n\t\tlet toSource = null;\r\n\t\tif (toId) {\r\n\t\t\ttoSource = this.getSourceById(toId);\r\n\t\t\tif (!toSource)\r\n\t\t\t\tthrow new Error(`Could not find \"to\" source ${toId}`);\r\n\t\t}\r\n\t\t\r\n\t\tconst fromIndex = this._playlist.indexOf(fromSource);\r\n\t\tthis._playlist.splice(fromIndex, 1);\r\n\t\t\r\n\t\tconst toIndex = toId ? this._playlist.indexOf(toSource) + 1 : 0;\r\n\t\tthis._playlist.splice(toIndex, 0, fromSource);\r\n\t\t\r\n\t\tif (this._currentSource)\r\n\t\t\tthis._currentIndex = this._playlist.indexOf(this._currentSource);\r\n\t\t\t\r\n\t\tthis._io.emit(\"playlist:moved\", { fromId, toId });\r\n\t\tconsole.log(`playlist: moved ${fromSource.title} to ${toSource ? `to after ${toSource.title}` : \"to the beginning\"}`);\r\n\t}\r\n\t\r\n\tdeleteSourceById(id) {\r\n\t\tconst source = this.getSourceById(id);\r\n\t\tif (!source)\r\n\t\t\tthrow new Error(`Cannot find source ${id}`);\r\n\t\t\t\r\n\t\tconst sourceIndex = this._playlist.indexOf(source);\r\n\t\t\t\r\n\t\tif (source == this._currentSource)\r\n\t\t\tif (this._playlist.length == 1)\r\n\t\t\t\tthis.setCurrentSource(null);\r\n\t\t\telse\r\n\t\t\t\tthis.playNextSource();\r\n\t\t\t\r\n\t\tthis._playlist.splice(sourceIndex, 1);\r\n\t\t\r\n\t\tif (this._currentSource)\r\n\t\t\tthis._currentIndex = this._playlist.indexOf(this._currentSource);\r\n\t\t\t\r\n\t\tthis._io.emit(\"playlist:removed\", {id});\r\n\t\tconsole.log(`playlist: deleted ${source.title}`);\r\n\t}\r\n\r\n\tregisterClient(client) {\r\n\t\tconst isLoggedIn = () => this._users.getUserForClient(client) !== null;\r\n\r\n\t\tclient.onActions({\r\n\t\t\t\"playlist:list\": () => {\r\n\t\t\t\treturn this._playlist;\r\n\t\t\t},\r\n\r\n\t\t\t\"playlist:current\": () => {\r\n\t\t\t\treturn this._createCurrentEvent();\r\n\t\t\t},\r\n\r\n\t\t\t\"playlist:add\": ({url}) => {\r\n\t\t\t\tif (!isLoggedIn())\r\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\r\n\r\n\t\t\t\treturn this.addSourceFromUrl$(url);\r\n\t\t\t},\r\n\r\n\t\t\t\"playlist:set-current\": ({id}) => {\r\n\t\t\t\tif (!isLoggedIn())\r\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\r\n\r\n\t\t\t\tconst source = this.getSourceById(id);\r\n\t\t\t\tif (!source)\r\n\t\t\t\t\treturn fail(`Cannot find source ${id}`);\r\n\r\n\t\t\t\tthis.setCurrentSource(source);\r\n\t\t\t},\r\n\r\n\t\t\t\"playlist:move\": ({fromId, toId}) => {\r\n\t\t\t\tif (!isLoggedIn())\r\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\r\n\t\t\t\t\t\r\n\t\t\t\tthis.moveSource(fromId, toId);\r\n\t\t\t},\r\n\r\n\t\t\t\"playlist:remove\": ({id}) => {\r\n\t\t\t\tif (!isLoggedIn())\r\n\t\t\t\t\treturn fail(\"You must be logged in to do that\");\r\n\r\n\t\t\t\tthis.deleteSourceById(id);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// d57e70e236ba4f8d9ebbe1e5c215e656\r\n\t\t});\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/playlist.js","import {ModuleBase} from \"../lib/module\";\r\n\r\nimport {validateSendMessage} from \"shared/validation/chat\";\r\nimport {fail} from \"shared/observable-socket\";\r\n\r\nconst MAX_HISTORY = 100;\r\nconst BATCH_SIZE = 10;\r\n\r\nexport class ChatModule extends ModuleBase {\r\n\tconstructor(io, usersModule) {\r\n\t\tsuper();\r\n\t\tthis._io = io;\r\n\t\tthis._users = usersModule;\r\n\t\tthis._chatLog = [];\r\n\t}\r\n\t\r\n\tsendMessage(user, message, type) {\r\n\t\tmessage = message.trim();\r\n\t\t\r\n\t\tconst validator = validateSendMessage(user, message, type);\r\n\t\tif (!validator.isValid)\r\n\t\t\treturn validator.throw$();\r\n\t\t\t\r\n\t\tconst newMessage = {\r\n\t\t\tuser: {name: user.name, color: user.color},\r\n\t\t\tmessage: message,\r\n\t\t\ttime: new Date().getTime(),\r\n\t\t\ttype: type\r\n\t\t};\r\n\t\t\r\n\t\tthis._chatLog.push(newMessage);\r\n\t\t\r\n\t\tif (this._chatLog.length >= MAX_HISTORY)\r\n\t\t\tthis._chatLog.splice(0, BATCH_SIZE);\r\n\t\t\t\r\n\t\tthis._io.emit(\"chat:added\", newMessage);\r\n\t}\r\n\t\r\n\tregisterClient(client) {\r\n\t\tclient.onActions({\r\n\t\t\t\"chat:list\": () => {\r\n\t\t\t\treturn this._chatLog;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t\"chat:add\": ({message, type}) => {\r\n\t\t\t\ttype = type || \"normal\";\r\n\t\t\t\t\r\n\t\t\t\tconst user = this._users.getUserForClient(client);\r\n\t\t\t\tif (!user)\r\n\t\t\t\t\treturn fail(\"You must be logged in\");\r\n\t\t\t\t\t\r\n\t\t\t\tthis.sendMessage(user, message, type);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/chat.js","import _ from \"lodash\";\r\nimport {Validator} from \"../validator\";\r\n\r\nexport let MESSAGE_TYPES = [\"normal\"];\r\n\r\nexport function validateSendMessage(user, message, type) {\r\n\tconst validator = new Validator();\r\n\t\r\n\tif (message.length > 50)\r\n\t\tvalidator.error(\"Message must be smaller than 50 characters\");\r\n\t\t\r\n\tif (message.trim().length === 0)\r\n\t\tvalidator.error(\"Message cannot be empty\");\r\n\t\t\r\n\tif (!_.includes(MESSAGE_TYPES, type))\r\n\t\tvalidator.error(`Invalid message type ${type}`);\r\n\t\t\r\n\treturn validator;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/chat.js","module.exports = require(\"webpack-dev-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-dev-middleware\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"webpack-hot-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-middleware\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 26\n// module chunks = 0","var path = require(\"path\"),\r\n\twebpack = require(\"webpack\"),\r\n\tExtractTextPlugin = require(\"extract-text-webpack-plugin\");\r\n\r\nconst vendorModules = [\r\n\t\"jquery\", \r\n\t\"lodash\",\r\n\t\"socket.io-client\", \r\n\t\"rxjs\", \r\n\t\"moment\",\r\n\t\"moment-duration-format\"];\r\n\r\nconst dirname = path.resolve(\"./\");\r\nfunction createConfig(isDebug) {\r\n\tconst devTool = isDebug ? \"eval-source-map\" : \"source-map\";\r\n\tconst plugins = [new webpack.optimize.CommonsChunkPlugin(\"vendor\", \"vendor.js\")];\r\n\t\r\n\tconst cssLoader = {test: /\\.css$/, loader: \"style!css\"};\r\n\tconst sassLoader = {test: /\\.scss$/, loader: \"style!css!sass\"};\r\n\tconst appEntry = [\"./src/client/application.js\"];\r\n\t\r\n\tif (!isDebug) {\r\n\t\tplugins.push(new webpack.optimize.UglifyJsPlugin());\r\n\t\tplugins.push(new ExtractTextPlugin(\"[name].css\"));\r\n\t\t\r\n\t\tcssLoader.loader = ExtractTextPlugin.extract(\"style\", \"css\");\r\n\t\tsassLoader.loader = ExtractTextPlugin.extract(\"style\", \"css!sass\");\r\n\t} else {\r\n\t\tplugins.push(new webpack.HotModuleReplacementPlugin());\r\n\t\tappEntry.splice(0, 0, \"webpack-hot-middleware/client\");\r\n\t}\r\n\t\r\n\t// ---------------------\r\n\t// WEBPACK CONFIG\r\n\treturn {\r\n\t\tdevtool: devTool,\r\n\t\tentry: {\r\n\t\t\tapplication: appEntry,\r\n\t\t\tvendor: vendorModules\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\tpath: path.join(dirname, \"public\", \"build\"),\r\n\t\t\tfilename: \"[name].js\",\r\n\t\t\tpublicPath: \"/build/\"\r\n\t\t},\r\n\t\tresolve: {\r\n\t\t\talias: {\r\n\t\t\t\tshared: path.join(dirname, \"src\", \"shared\")\r\n\t\t\t}\r\n\t\t},\r\n\t\tmodule: {\r\n\t\t\tloaders: [\r\n\t\t\t\t{ test: /\\.js$/, loader: \"babel\", exclude: /node_modules/ },\r\n\t\t\t\t{ test: /\\.js$/, loader: \"eslint\", exclude: /node_modules/ },\r\n\t\t\t\t{ test: /\\.(png|jpg|jpeg|gif|woff|ttf|eot|svg|woff2)/, loader: \"url-loader?limit=1024\" },\r\n\t\t\t\tcssLoader,\r\n\t\t\t\tsassLoader\r\n\t\t\t]\r\n\t\t},\r\n\t\tplugins: plugins\r\n\t};\r\n\t// ---------------------\r\n}\r\n\r\nmodule.exports = createConfig(true);\r\nmodule.exports.create = createConfig;\n\n\n// WEBPACK FOOTER //\n// ./webpack.client.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"extract-text-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"extract-text-webpack-plugin\"\n// module id = 29\n// module chunks = 0"],"sourceRoot":""}